#textdomain wesnoth-Grnk

[scenario]
    id=15a_Endgame
    name=_"Endgame"
    next_scenario=15s_Epilogue

    map_data="{~add-ons/Grnk/part2/maps/14d_Submission.map}"

    {DEFAULT_SCHEDULE_FIRST_WATCH}
    turns=-1

    {GRNK2_STORY_15}

    [side]
        side=1
        controller=human
        no_leader=yes

        persistent=yes
        save_id="Grnk and Vanak"

        team_name=Grnk
        user_team_name=_"Grnk"

        recruit=Goblin Spearman,Orcish Grunt

        gold=0
    [/side]

    [side]
        side=2
        controller=ai
        no_leader=yes

        team_name=master
        user_team_name=_"The Master's Minions"

        recruit=Skeleton,Skeleton Archer,Bone Shooter,Chocobone,Deathblade,Revenant,Draug,Banebow,Wraith,Shadow

        {GOLD 400 -500 600}
    [/side]

    [side]
        side=3
        controller=ai
        no_leader=yes

        team_name=master
        user_team_name=_"The Master's Minions"

        recruit=Skeleton,Skeleton Archer,Bone Shooter,Deathblade,Revenant

        {GOLD 200 -300 400}
    [/side]

    [side]
        side=4
        controller=ai
        no_leader=yes

        team_name=master
        user_team_name=_"The Master's Minions"

        recruit=Chocobone,Ghost,Wraith,Shadow

        {GOLD 200 -300 400}
    [/side]

    [side]
        side=5
        controller=ai
        no_leader=yes

        team_name=undead
        user_team_name=_"More Swamp Squatters"
        recruit=Saurian Skirmisher,Saurian Augur

        {GOLD 175 -200 225}

        # Strongly target Quank
        [ai]
            [goal]
                [criteria]
                    id=Quank
                [/criteria]

                value=100
            [/goal]
        [/ai]
    [/side]

    [side]
        side=6
        controller=null
        no_leader=yes
        hidden=yes

        save_id="the Hynderwlt Mages"
        persistent=yes
        team_name=Grnk
        user_team_name=_"Grnk"

        {GOLD 500 400 300}
    [/side]

    [side] # Bats
        side=7
        controller=ai
        no_leader=yes
        hidden=yes

        team_name=bats
    [/side]

    [side]
        side=8
        controller=null
        no_leader=yes
        hidden=yes

        persistent=yes
        save_id="Langzight"

        team_name=Grnk
        user_team_name=_"Grnk"

        {GOLD 400 300 200}
    [/side]

    {CAMPFIRE 27 23}

    [event]
        name=prestart

        [gold]
            side=1
            amount=$S15_gold
        [/gold]
        {CLEAR_VARIABLE S15_gold}

        {SETUP_MAP_S15 0 32 21 se}

        {CLEAR_VARIABLE stored_Grnk_S14,stored_Vanak_S14,stored_Quank_S14,stored_peasant_leader_S14,stored_other_units_S14}

        # Quank's in a different place between the scenarios, adjusted here
        [modify_unit]
            [filter]
                id=Quank
            [/filter]

            x,y=31,26
        [/modify_unit]

        [recall]
            id=Grashnak
            x,y=30,20
        [/recall]
        [recall]
            id=Gort
            x,y=30,21
        [/recall]

        # Also put the saurian leader back out, or a different one in case he was killed
        [if]
            [variable]
                name=stored_saurian_leader_S14.length
                not_equals=0
            [/variable]

            [then]
                {VARIABLE stored_saurian_leader_S14.side 5}
                [unstore_unit]
                    variable=stored_saurian_leader_S14
                    x,y=49,38
                [/unstore_unit]

                {FULL_HEAL_AND_CURE (id=saurian_leader)}
            [/then]

            [else]
                {UNIT 5 (Saurian Oracle) 49 38 (id,canrecruit=saurian_leader,yes)}
            [/else]
        [/if]

        {FOREACH stored_saurian_villages_S14 i_v}
            [capture_village]
                side=5
                x,y=$stored_saurian_villages_S14[$i_v].x,$stored_saurian_villages_S14[$i_v].y
            [/capture_village]
        {NEXT i_v}
        {CLEAR_VARIABLE stored_saurian_leader_S14,stored_saurian_villages_S14}

        # Disable the keep in the south, so that Quank/Vanak cannot use it
        [terrain]
            x,y=40,50
            terrain=Ce
        [/terrain]

        {SET_LABEL 44 50 _"Move Quank here"}
        {PLACE_IMAGE (scenery/signpost.png) 44 50}

        {PRUNES_SETUP 1 Grnk 24 41 "*^X*,Wo,Q*"}

        [objectives]
            side=1,6,8
            summary=_"<span color='#A050A0'>Thwart The Master's Grand Plan Yet Again</span>"
            [objective]
                description=_"Defeat all enemy leaders"
                condition=win
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        id=Quank
                    [/have_unit]
                    [not]
                        [have_unit]
                            id=Langzight
                        [/have_unit]
                    [/not]
                [/show_if]
                caption=_"Also useful, but not a necessary victory condition:"
                description=_"Move Quank to the signpost in the south to get reinforcements"
                condition=win
            [/objective]
            [objective]
                description=_"Death of Grnk"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Vanak"
                condition=lose
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        id=Quank
                    [/have_unit]
                [/show_if]
                description=_"Death of Quank"
                condition=lose
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        id=Langzight
                    [/have_unit]
                [/show_if]
                description=_"Death of Langzight"
                condition=lose
            [/objective]
            [objective]
                [show_if]
                    [have_unit]
                        id=Grossauba
                    [/have_unit]
                [/show_if]
                description=_"Death of Grossauba"
                condition=lose
            [/objective]
            [note]
                description=_"Peasants can still round up their brothers by capturing unowned villages."
            [/note]
            [note]
                description=_"Any goblin who ends up next to Grnk permanently converts to Grnk's side."
            [/note]
            [note]
                [show_if]
                    [have_unit]
                        id=Master
                    [/have_unit]
                [/show_if]
                description=_"The Master's has a very strong mind:"
            [/note]
            [note]
                [show_if]
                    [have_unit]
                        id=Master
                    [/have_unit]
                [/show_if]
                bullet="  - "
                description=_"Any non-animal unit attacking him with non-magical weapons will experience an unpleasant surprise."
            [/note]
            [note]
                [show_if]
                    [have_unit]
                        id=Master
                    [/have_unit]
                [/show_if]
                bullet="  - "
                description=_"Any animal attacking him will join his side."
            [/note]
            {IS_LAST_SCENARIO}
        [/objectives]
    [/event]

    [event]
        name=start

        {MESSAGE_FACING Vanak Grnk "" _"Where wizard go?"}
        {MESSAGE Grnk "" "" _"He said that he was off to get reinforcements."}
        {MESSAGE_FACING Quank Grnk "" _"And you believe that? What if he is the Master after all and is rounding up more undead?"}
        {MESSAGE Grnk "" "" _"Honestly, I don't know. But if he is the Master, there is not really anything we can do to stop him any more. So we might as well assume that ..."}

        {GRND_S15 2 53 8}

        {MESSAGE_FACING Grnk Grnd "" _"Grnd, you little impostor! I'm going to get you!"}
        {MESSAGE Grnd "" "" _"Hahahahaha! I want to see you try. Look whom I brought to fight you."}

        {REPEAT 12 (
            {CLOSE_EMPTY_HEX 51 9 "M*,M*^*,W*,C*" 0}
            {GENERIC_UNIT 2 (Goblin Spearman) $hex_x $hex_y}
        )}
        {CLEAR_VARIABLE hex_x,hex_y}

        {MESSAGE Grnk "" "" _"Don't do that! Those are our brothers."}
        {MESSAGE Grnd "" "" _"Hah! Maybe they are your brothers. Remember who I am and what you have called me? I have no brothers!"}
        {MESSAGE Grnk "" "" _"You're a monster! I will convince them to join me. One by one, if I have to."}
        {MESSAGE Grnd "" "" _"You do that, I don't care. You wouldn't think that I rely on these idiots anyway, would you? I just brought them because I know that it would piss you off. Instead, here's who's really going to kill you."}

        {SOUND magic-dark-big.ogg}
        {DELAY 100}
        {OPEN_PORTAL (52,53,54) (8,7,8)}

        {PORTAL_FALL 52 8}
        {MESSAGE Grnd "" "" _"Hahahahaha! Stupid goblin!"}

        {UNDEAD_THRU_PORTAL 53 7 2 sw 54 7 yes}
        {UNDEAD_THRU_PORTAL 54 8 2 sw 53 9 yes}
        {UNDEAD_THRU_PORTAL 52 8 2 sw 52 7 yes}

        {MESSAGE Grnd "" "" _"And you won't be able to shut down the portals this time, the Master showed me how to prevent that. Oh, and just in case you're thinking about running, have a look behind you."}

        {FIREBALL_IN 3 8 8 "units/undead-skeletal/deathknight.png" se "~GS()"}

        [unit]
            side=3
            type=Death Knight
            id=undead_leader3
            canrecruit=yes

            x,y=8,8
            facing=se
        [/unit]

        {FIREBALL_IN 4 8 35 "units/undead-skeletal/deathknight.png" se "~GS()"}

        [unit]
            side=4
            type=Death Knight
            id=undead_leader4
            canrecruit=yes

            x,y=8,35
            facing=ne
        [/unit]

        {MESSAGE_FACING Quank Grnk "" _"Looks like odds are stacked against us a bit. Let's hope that Grossauba will indeed be back, and soon. But either way, I think we should not rely on that and be proactive instead."}
        {MESSAGE Grnk "" "" _"What are you suggesting?"}
        {MESSAGE Quank "" "" _"Send me to get help. I believe that I can have some ... business negotiations with Lieutenant Langzight and convince him to join us, but I need to go back to Lake Teefh personally for that. Which means, of course, fighting my way past those lizards in the south again, so you'll have to send some troops with me that you then won't have to hold off the undead."}
        {MESSAGE Grnk "" "" _"That's a difficult choice to make."}
        {MESSAGE Quank "" "" _"You better make up your mind quickly. I am quite certain that those makeshift bridges the orcs built won't last for much longer. If you want us to go, you need to send us off quickly."+{NOTE _"The bridges built by the orcs will be swept away at the end of turn 4. After that, nobody else will be able to reach whomever you decide to send south."}}
    [/event]

    {SET_PORTAL_ANIM 52 8}
    {SET_PORTAL_ANIM 53 7}
    {SET_PORTAL_ANIM 54 8}

    # Undead appear at the portals
    [event]
        name=side 2 turn end
        first_time_only=no

        {UNDEAD_THRU_PORTAL 52 8 2 sw 51 9 yes}
        {UNDEAD_THRU_PORTAL 53 7 2 sw 52 7 yes}
        {UNDEAD_THRU_PORTAL 54 8 2 sw 53 9 yes}
    [/event]

    # Convert Grnd's goblins to Grnk's side, and give them surefire
    [event]
        name=convert_goblin_message

        {MESSAGE Grnk "" "" _"Join me. Grnd is just using you and considers you expendable. You might still die if you're with me, but at least you will get a fighting chance."}
        {MESSAGE $unit.id "" "" _"$unit.name no like little goblin. $unit.name like little goblin. $unit.name join little goblin."}
        {MESSAGE Grnk "" "" _"Right. It almost scares me that that made sense to me."}
    [/event]

    [event]
        name=convert_goblin
        first_time_only=no

        [fire_event]
            name=convert_goblin_message
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]

        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]

            side=1
        [/modify_unit]
        {SUREFIRE (id=$unit.id)}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            race=goblin
            [not]
                id=Grnd
            [/not]
            [filter_adjacent]
                id=Grnk
            [/filter_adjacent]
        [/filter]

        [fire_event]
            name=convert_goblin
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=Grnk
            [filter_adjacent]
                side=2
                race=goblin
                [not]
                    id=Grnd
                [/not]
            [/filter_adjacent]
        [/filter]

        [store_unit]
            [filter]
                side=2
                race=goblin
                [not]
                    id=Grnd
                [/not]
                [filter_adjacent]
                    id=Grnk
                [/filter_adjacent]
            [/filter]

            variable=tmp_goblins
        [/store_unit]

        {FOREACH tmp_goblins i_g}
            [fire_event]
                name=convert_goblin
                [primary_unit]
                    id=$tmp_goblins[$i_g].id
                [/primary_unit]
            [/fire_event]
        {NEXT i_g}

        {CLEAR_VARIABLE tmp_goblins}
    [/event]

    # The bridges the orcs built in S14 disappear after a while
    [event]
        name=turn 1 end

        [scroll_to]
            x,y=32,34
        [/scroll_to]

        {MESSAGE_NOSCROLL Quank _"There go the bridges."}

        [terrain]
            x,y=25-99,27-99
            [and]
                terrain=Wo^B*
            [/and]

            terrain=Wo
        [/terrain]

        [redraw]
        [/redraw]

        {MESSAGE_NOSCROLL Quank _"Well, that's too bad. They were a brilliant feat of orcish engineering."}
    [/event]

    # When Quank gets to the signpost, he leaves and will reappear later with support
    [event]
        name=moveto

        [filter]
            id=Quank
            x,y=44,50
        [/filter]

        [store_unit]
            [filter]
                id=Quank
            [/filter]

            variable=S.stored_Quank
        [/store_unit]

        {MESSAGE Quank "" "" _"I'll be back as soon as I can. With support, if possible. Wish me luck."}
        {MOVE_UNIT_OFF_MAP_CORE Quank se ()}
        {MESSAGE Vanak "" "" _"Vanak say luck."}

        [remove_item]
            x,y=44,50
        [/remove_item]
        {SET_LABEL 44 50 ""}

        # Set a turn number for Quank's return
        {VARIABLE S.Quank_returns_turn "$($turn_number+6)"}

        [event]
            name=side 7 turn end,Quank_returns
            first_time_only=no

            [if]
                [variable]
                    name=S.Quank_returns_turn
                    equals=$turn_number
                [/variable]

                [then]
                    # Just in case there are units here, move them out of the way
                    [move_unit]
                        x,y=55-60,23-28
                        [filter_side]
                            [enemy_of]
                                side=1
                            [/enemy_of]
                        [/filter_side]

                        to_x,to_y=53,24
                    [/move_unit]

                    # And in case an allied unit is left at the keep to be built here
                    [move_unit]
                        x=56,57   ,58
                        y=26,26-27,26

                        to_x,to_y=56,24
                    [/move_unit]

                    {VARIABLE S.stored_Quank.side 8}
                    {VARIABLE S.stored_Quank.facing nw}
                    {MOVE_UNIT_ONTO_MAP 8 "$S.stored_Quank.type" 60 25 nw ()}
                    [unstore_unit]
                        variable=S.stored_Quank
                        x,y=60,25
                    [/unstore_unit]
                    {CLEAR_VARIABLE S.stored_Quank}
                    {FULL_HEAL_AND_CURE id=Quank}

                    {MESSAGE Quank "" "" _"Grnk, I am back. And look whom I brought."}
                    {MOVE_UNIT id=Quank 59 26}

                    # Get Langzight from the recall list
                    [store_unit]
                        [filter]
                            id=Langzight
                        [/filter]

                        variable=tmp_Langzight
                        kill=yes
                    [/store_unit]

                    {VARIABLE tmp_Langzight.facing nw}
                    {MOVE_UNIT_ONTO_MAP 8 "$tmp_Langzight.type" 60 25 nw ()}
                    [unstore_unit]
                        variable=tmp_Langzight
                        x,y=60,25
                    [/unstore_unit]

                    {MESSAGE Langzight "" "" _"Hello, Grnk. After General Koorzhar's removal and due in no small part to Quank's persuasion skills, HQ agreed that it would be in Shmaltupp's best interest to support you."}
                    {MESSAGE Grnk "" "" _"That's very, uh, pragmatic of them. Nevertheless, we extend our thanks to you personally, $tmp_Langzight.type Langzight."}
                    {MESSAGE Langzight "" "" _"Don't mention it. It's long overdue that we play our role in this fight."}
                    {CLEAR_VARIABLE tmp_Langzight}

                    {MOVE_UNIT id=Langzight 58 26}

                    [terrain]
                        x=56,57
                        y=26,26-27
                        terrain=Ce
                    [/terrain]
                    [terrain]
                        x,y=58,26
                        terrain=Ke
                    [/terrain]

                    [modify_side]
                        side=8
                        controller=human
                        hidden=no
                    [/modify_side]

                    [show_objectives]
                    [/show_objectives]
                [/then]
            [/if]
        [/event]
    [/event]

    # Master appears
    [event]
        name=side 5 turn 8 end,master_appears

        {MASTER_S15 2 55 7}

        {MESSAGE_FACING Master Grnd "" _"Grnd, stop fooling around! It's time to put an end to this."}
        {MESSAGE Grnd "" "" _"But I am having fun."}
        {MESSAGE Master "" "" _"Yes, exactly."}
        {MESSAGE Master "" "" _"Grnk, we have yet another little surprise for you."}

        {BRING_OUT_MAL_AN}

        # Grossauba returns at that point
        {SCROLL_TO 39 1}

        # Just in case there are units here, move them out of the way
        [move_unit]
            x,y=37-45,1-5
            [filter_side]
                [enemy_of]
                    side=1
                [/enemy_of]
            [/filter_side]

            to_x,to_y=46,6
        [/move_unit]

        # And in case an allied unit is left at the keep to be built here
        [move_unit]
            x=39,40, 41
            y=3, 1-3,2-3

            to_x,to_y=40,4
        [/move_unit]

        # Need to kill Wyssauba,Grossauba off the Hynderwlt recall list
        [kill]
            id=Wyssauba,Grossauba
        [/kill]

        {VARIABLE stored_Grossauba_S9.side 6}
        {VARIABLE stored_Grossauba_S9.facing se}
        {MOVE_UNIT_ONTO_MAP 6 "$stored_Grossauba_S9.type" 39 1 se ()}
        [unstore_unit]
            variable=stored_Grossauba_S9
            x,y=39,1
        [/unstore_unit]
        {CLEAR_VARIABLE stored_Grossauba_S9}

        {MESSAGE Grossauba "" "" _"Grnk, now!"}
        {MESSAGE Grnk "" "" _"Grossauba, you really did come back. And you really are not the Master!"}
        {MESSAGE Grossauba "" "" _"Indeed. Now stop wasting time and do as we said! I cannot suppress the Masters power for much longer."}
        {MESSAGE Grnk "" "" _"Right. Let's see ..."}

        [store_unit]
            [filter]
                role=undead_guard
            [/filter]

            variable=tmp_guards
        [/store_unit]

        {FOREACH tmp_guards i_g}
            {WHITE_MISSILE_KILL $tmp_guards[$i_g].id "~GS()~CS(0,-50,0)"}
        {NEXT i_g}
        {CLEAR_VARIABLE tmp_guards}

        {MESSAGE Grnk "" "" _"And this one's for you, Mal An."}

        {WHITE_MISSILE (Mal An) "~GS()~CS(0,-50,0)"}

        [modify_unit]
            [filter]
                id=Mal An
            [/filter]

            hitpoints=0
        [/modify_unit]

        {MESSAGE (Mal An) "" "" _"Nooooo! Can this really be the end of Mal An?"}
        {MESSAGE Grnk "" "" _"It can. And it is. And no secret revival and attaching to my shadow this time! Grossauba showed me what to do about that."}

        {WHITE_MISSILE (Mal An) "~GS()~CS(0,-50,0)"}
        [kill]
            id=Mal An
            animate=yes
        [/kill]

        {MASTER_EXPLANATION_S15 2 55 7}

        [terrain]
            x=54 ,55,55,56
            y=6-7,6 ,8 ,6-7
            terrain=Co
        [/terrain]
        [terrain]
            x,y=55,7
            terrain=Ko
        [/terrain]
        [redraw]
        [/redraw]

        {MOVE_UNIT (id=Master) 57 7}
        {MOVE_UNIT (id=Grnd) 55 7}

        {MESSAGE Grossauba "" "" {GASP _"sigh"}}

        {MOVE_UNIT (id=Grossauba) 40 2}

        [terrain]
            x=39,40,40,41
            y=3 ,1 ,3 ,2-3
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=40,2
            terrain=Ke
        [/terrain]
        [redraw]
        [/redraw]

        {VARIABLE stored_Teussauba_S9.side 6}
        [unstore_unit]
            variable=stored_Teussauba_S9
            x,y=41,3
        [/unstore_unit]
        {CLEAR_VARIABLE stored_Teussauba_S9}

        [modify_unit]
            [filter]
                id=Teussauba
            [/filter]

            canrecruit=no
            overlays=misc/hero-icon.png
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/modify_unit]

        {MESSAGE_FACING Teussauba Grnk "" _"Hello, Grnk."}
        {MESSAGE Grnk "" "" _"Teussauba!"}
        {MESSAGE Teussauba "" "" _"Long time no see. And look whom else I brought."}

        {FOREACH stored_animals_S4 i_a}
            {CLOSE_EMPTY_HEX 42 3 "C*,K*" 0}
            {VARIABLE stored_animals_S4[$i_a].moves $stored_animals_S4[$i_a].max_moves}
            {VARIABLE stored_animals_S4[$i_a].side 6}
            [unstore_unit]
                variable=stored_animals_S4[$i_a]
                x,y=$hex_x,$hex_y
            [/unstore_unit]
        {NEXT i_a}
        {FULL_HEAL_AND_CURE (side=6)}

        # Clear animals variable; also can get rid of the trolls (not needed here)
        {CLEAR_VARIABLE stored_animals_S4,stored_trolls_S4,hex_x,hex_y}

        [modify_side]
            side=6

            controller=human
            hidden=no
        [/modify_side]

        [show_objectives]
        [/show_objectives]

        [event]
            name=side 2 turn

            [event]
                name=side 2 turn

                {MESSAGE Master "" "" _"So, Grossauba, since we are finally going head to head, you might as well tell me who you were as an undead."}
                {MESSAGE Grossauba "" "" _"You really haven't figured it out yet, have you?"}

                [store_unit]
                    [filter]
                        id=Grossauba
                    [/filter]

                    variable=tmp_Grossauba
                [/store_unit]

                [unit]
                    type=Ghast
                    id=Sklaf
                    name=_"Sklaf"
                    side=6
                    to_variable=tmp_Sklaf

                    facing=$tmp_Grossauba.facing
                [/unit]

                {FIREBALL_UNDEAD_IN 6 tmp_Sklaf $tmp_Grossauba.x $tmp_Grossauba.y $tmp_Grossauba.facing}

                {MESSAGE Sklaf "" "" _"You truly are evil, Master. Here's your brandy."}
                {MESSAGE Master "" "" _"Sklaf!"}

                [modify_unit]
                    [filter]
                        id=Sklaf
                    [/filter]

                    profile={GROSSAUBA_SKLAF_PORTRAIT}
                    name=_"Grossauba Sklaf"
                [/modify_unit]

                {MESSAGE Sklaf "" "" _"You're so full of yourself that it would never even occur to you that I might lower myself to being a simple servant. It's the perfect disguise."}

                {FIREBALL_UNDEAD_IN 6 tmp_Grossauba $tmp_Grossauba.x $tmp_Grossauba.y $tmp_Grossauba.facing}

                {CLEAR_VARIABLE tmp_Sklaf,tmp_Grossauba}
            [/event]
        [/event]
    [/event]

    # Animals attacking the Master get converted to his side before they can attack
    [event]
        name=attack
        first_time_only=no

        [filter]
            race=monster
            [or]
                race=bats
            [/or]
        [/filter]
        [filter_second]
            id=Master
        [/filter_second]

        {MESSAGE Master "" "" _"Join my minions, weak mind."}

        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]

            side=$second_unit.side
        [/modify_unit]
    [/event]

    # Units attacking Master with non-magical weapon go insane after the attack.
    # Animals turn over to his side.
    [event]
        name=first_time_burn_message

        {MESSAGE Master "" "" _"Harharharharhar!"}
    [/event]

    [event]
        name=attack end
        first_time_only=no

        [filter]
            [not]
                race=monster
                [or]
                    race=bats
                [/or]
            [/not]
        [/filter]
        [filter_second]
            id=Master
        [/filter_second]
        [filter_attack]
            [not]
                special=magical
            [/not]
        [/filter_attack]

        [if]
            [variable]
                name=unit.race
                equals=orc
            [/variable]
            [or]
                [variable]
                    name=unit.race
                    equals=goblin
                [/variable]
            [/or]

            [then]
                {MESSAGE unit "" "" _"Aaah! $unit.name burn!!!"}
            [/then]

            [else]
                {MESSAGE unit "" "" _"Aaah! It burns!!!"}
            [/else]
        [/if]

        # Runs around like crazy
        {REPEAT 5 (
            {CLOSE_EMPTY_HEX $unit.x $unit.y (M*,M*^*,W*,Q*) 2}
            {MOVE_UNIT id=$unit.id $hex_x $hex_y}
        )}

        {FIREBALL_KILL $unit.id}
        {PLACE_IMAGE "items/bones.png~BLEND(0,0,0,0.4)" $hex_x $hex_y}
        {CLEAR_VARIABLE hex_x,hex_y}

        [fire_event]
            name=first_time_burn_message
        [/fire_event]
    [/event]

    [event]
        name=victory

        {MESSAGE Vanak "" "" _"Vanak no like skeleton."}

        # Set variables to get the right messages in the epilogue
        {VARIABLE joined_Grossauba yes}

        [if]
            [have_unit]
                id=Grashnak
            [/have_unit]

            [then]
                {VARIABLE Grashnak_alive yes}
            [/then]
        [/if]

        {DELAY 1000}

        [endlevel]
            result=victory
            carryover_report=no
            replay_save=yes
            linger_mode=no
        [/endlevel]
    [/event]

    {SUREFIRE_BRITTLE_EVENTS 1}
    {PEASANT_EVENTS_P2S14 1 999} # Boats are already on Grnk's side
    {BAT_EVENTS_P2S14 7}
    {MAL_AN_SHADOW}

    # Finally, the standard events for all or most scenarios
    {GRNK_DEATH}
    {VANAK_DEATH}
    {QUANK_DEATH}
    {LANGZIGHT_DEATH}
    {GROSSAUBA_DEATH}
    {GRASHNAK_DEATH}
[/scenario]
